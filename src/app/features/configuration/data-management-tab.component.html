<div class="card shadow-sm">
  <div class="card-header bg-primary text-white">
    <h5 class="mb-0">
      <i class="bi bi-gear-wide-connected me-2"></i>
      Data Management
    </h5>
  </div>
  <div class="card-body">
    <div class="row">
      <!-- Data Statistics -->
      <div class="col-lg-6 mb-4">
        <h6 class="fw-bold mb-3">Current Data</h6>
        <div class="list-group">
          <div class="list-group-item d-flex justify-content-between align-items-center">
            <span><i class="bi bi-building me-2"></i>Pillars</span>
            <span class="badge bg-primary rounded-pill">{{ dataStatistics.pillars }}</span>
          </div>
          <div class="list-group-item d-flex justify-content-between align-items-center">
            <span><i class="bi bi-layers me-2"></i>Functions/Capabilities</span>
            <span class="badge bg-primary rounded-pill">{{ dataStatistics.functionCapabilities }}</span>
          </div>
          <div class="list-group-item d-flex justify-content-between align-items-center">
            <span><i class="bi bi-bar-chart-steps me-2"></i>Maturity Stages</span>
            <span class="badge bg-primary rounded-pill">{{ dataStatistics.maturityStages }}</span>
          </div>
          <div class="list-group-item d-flex justify-content-between align-items-center">
            <span><i class="bi bi-tools me-2"></i>Technologies/Processes</span>
            <span class="badge bg-primary rounded-pill">{{ dataStatistics.technologiesProcesses }}</span>
          </div>
          <div class="list-group-item d-flex justify-content-between align-items-center">
            <span><i class="bi bi-check-circle me-2"></i>Assessment Responses</span>
            <span class="badge bg-primary rounded-pill">{{ dataStatistics.assessmentResponses }}</span>
          </div>
        </div>
      </div>

      <!-- Export/Import Actions -->
      <div class="col-lg-6 mb-4">
        <h6 class="fw-bold mb-3">Actions</h6>

        <!-- Export Data -->
        <div class="card mb-3">
          <div class="card-body">
            <h6 class="card-title">
              <i class="bi bi-download me-2"></i>
              Export Data
            </h6>
            <p class="card-text text-muted small">
              Download all your configuration data as a JSON file.
            </p>
            <button
              class="btn btn-outline-primary"
              [disabled]="isExporting"
              (click)="onExportData()">
              <span *ngIf="isExporting" class="spinner-border spinner-border-sm me-2"></span>
              <i *ngIf="!isExporting" class="bi bi-download me-2"></i>
              {{ isExporting ? 'Exporting...' : 'Export Data' }}
            </button>
          </div>
        </div>

        <!-- Import Data -->
        <div class="card mb-3">
          <div class="card-body">
            <h6 class="card-title">
              <i class="bi bi-upload me-2"></i>
              Import Data
            </h6>
            <p class="card-text text-muted small">
              Upload a JSON export file to completely replace the current database. This performs a complete database reset and imports the data with original IDs preserved.
            </p>
            <div class="mb-3">
              <input
                type="file"
                class="form-control"
                accept=".json"
                [disabled]="isImporting"
                (change)="onFileSelected($event)">
            </div>
            <div class="alert alert-warning" role="alert">
              <i class="bi bi-exclamation-triangle me-2"></i>
              <strong>Warning:</strong> Importing data will completely reset the database and replace ALL existing data with the imported data.
              The original IDs from the export will be preserved. Make sure to export your current data first as a backup.
            </div>
          </div>
        </div>

        <!-- Generate Demo Data -->
        <div class="card mb-3 border-success">
          <div class="card-body">
            <h6 class="card-title text-success">
              <i class="bi bi-magic me-2"></i>
              Generate Demo Data
            </h6>
            <p class="card-text text-muted small">
              Reset the database and populate with comprehensive demo technologies and processes for all functions and capabilities.
            </p>

            <!-- Demo Data Statistics -->
            <div *ngIf="demoDataStats" class="mb-3">
              <div class="row text-center">
                <div class="col-3">
                  <div class="text-success fw-bold fs-5">{{ demoDataStats.functionsWithData }}</div>
                  <small class="text-muted">Functions</small>
                </div>
                <div class="col-3">
                  <div class="text-primary fw-bold fs-5">{{ demoDataStats.totalTechnologies }}</div>
                  <small class="text-muted">Technologies</small>
                </div>
                <div class="col-3">
                  <div class="text-info fw-bold fs-5">{{ demoDataStats.totalProcesses }}</div>
                  <small class="text-muted">Processes</small>
                </div>
                <div class="col-3">
                  <div class="text-warning fw-bold fs-5">{{ demoDataStats.totalItems }}</div>
                  <small class="text-muted">Total Items</small>
                </div>
              </div>
            </div>

            <button
              class="btn btn-outline-success"
              [disabled]="isGeneratingDemo"
              (click)="onGenerateDemoData()">
              <span *ngIf="isGeneratingDemo" class="spinner-border spinner-border-sm me-2"></span>
              <i *ngIf="!isGeneratingDemo" class="bi bi-magic me-2"></i>
              {{ isGeneratingDemo ? 'Resetting & Generating Demo Data...' : 'Reset & Generate Demo Data' }}
            </button>

            <div class="alert alert-info mt-3" role="alert">
              <i class="bi bi-info-circle me-2"></i>
              <strong>Demo Data Includes:</strong> This will first reset the database, then add at least 2 technologies and 2 processes for each function and capability across all five Zero Trust pillars (Identity, Devices, Networks, Applications & Workloads, and Data). The demo data emulates an Azure environment with realistic examples including Azure services, Microsoft security tools, and industry-standard practices. Additionally, sample assessment responses will be generated for all pillars to demonstrate the reporting capabilities. <em>Note: This is AI-generated demonstration data designed to showcase the assessment tool's capabilities and is not intended to be an all-encompassing list of security technologies and processes.</em>
            </div>

            <div class="alert alert-warning mt-3" role="alert">
              <i class="bi bi-exclamation-triangle-fill me-2"></i>
              <strong>Important Disclaimer:</strong> The demo data is AI-generated and should not be considered a complete or real-world Zero Trust architecture. It is for demonstration purposes only and should not be used as actual security guidance for production environments.
            </div>

            <div *ngIf="demoDataExists" class="alert alert-warning mt-3" role="alert">
              <i class="bi bi-exclamation-triangle-fill me-2"></i>
              <strong>Note:</strong> Demo data already exists. Clicking the button above will reset the database first and then generate fresh demo data.
            </div>
          </div>
        </div>

        <!-- Reset Database -->
        <div class="card border-danger">
          <div class="card-body">
            <h6 class="card-title text-danger">
              <i class="bi bi-exclamation-triangle me-2"></i>
              Reset Database
            </h6>
            <p class="card-text text-muted small">
              Completely drop the database from IndexedDB and reinitialize with fresh ZTMM framework structure.
            </p>
            <button
              class="btn btn-outline-danger"
              [disabled]="isResetting"
              (click)="onResetDatabase()">
              <span *ngIf="isResetting" class="spinner-border spinner-border-sm me-2"></span>
              <i *ngIf="!isResetting" class="bi bi-arrow-clockwise me-2"></i>
              {{ isResetting ? 'Resetting...' : 'Reset Database' }}
            </button>
            <div class="alert alert-danger mt-3" role="alert">
              <i class="bi bi-exclamation-triangle-fill me-2"></i>
              <strong>Danger Zone:</strong> This action will completely delete the entire database from
              IndexedDB and recreate it from scratch. All data including custom pillars, function/capabilities,
              technologies/processes, and assessment responses will be permanently lost. Only the default
              ZTMM framework structure will remain.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
